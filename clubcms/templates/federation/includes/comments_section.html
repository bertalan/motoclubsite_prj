{% load i18n %}
{# Comments section for external event detail page #}
<div class="comments-section">
    <h3>{% trans "Club Discussion" %}</h3>
    <p style="font-size: 0.85rem; color: var(--color-text-muted, #6b7280); margin-bottom: 1.5rem;">
        {% trans "Comments are visible only to our club members. They are not shared with the partner club." %}
    </p>

    {# Existing comments #}
    {% if comments %}
        <div class="comments-list" style="margin-bottom: 2rem;">
            {% for comment in comments %}
                <div class="comment" style="padding: 1rem; border: 1px solid var(--color-border, #e5e7eb); border-radius: 0.375rem; margin-bottom: 0.75rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                        <strong style="font-size: 0.9rem;">{{ comment.user.get_visible_name }}</strong>
                        <span style="font-size: 0.75rem; color: var(--color-text-muted, #6b7280);">
                            {{ comment.created_at|date:"d M Y H:i" }}
                        </span>
                    </div>
                    <p style="margin: 0; line-height: 1.5;">{{ comment.content|linebreaksbr }}</p>

                    {# Delete button (own comments only) #}
                    {% if comment.user == request.user %}
                        <form method="post"
                              action="{% url 'federation_frontend:delete_comment' club_code=event.source_club.short_code event_id=event.pk %}"
                              style="margin-top: 0.5rem;">
                            {% csrf_token %}
                            <input type="hidden" name="comment_id" value="{{ comment.pk }}">
                            <button type="submit"
                                    style="background: none; border: none; color: #ef4444; font-size: 0.75rem; cursor: pointer; padding: 0;"
                                    onclick="return confirm('{% trans "Delete this comment?" %}');">
                                {% trans "Delete" %}
                            </button>
                        </form>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p style="color: var(--color-text-muted, #6b7280); margin-bottom: 1.5rem;">
            {% trans "No comments yet. Be the first to start a discussion!" %}
        </p>
    {% endif %}

    {# Add comment form #}
    {% if is_active_member %}
        <form method="post"
              action="{% url 'federation_frontend:add_comment' club_code=event.source_club.short_code event_id=event.pk %}">
            {% csrf_token %}
            <div style="margin-bottom: 0.75rem;">
                <label for="comment-content" style="display: block; font-weight: 600; margin-bottom: 0.25rem; font-size: 0.9rem;">
                    {% trans "Add a comment" %}
                </label>
                <textarea name="content" id="comment-content" rows="3" required maxlength="2000"
                          placeholder="{% trans 'Share your thoughts with fellow club members...' %}"
                          style="width: 100%; padding: 0.75rem; border: 1px solid var(--color-border, #ccc); border-radius: 0.375rem; font-size: 0.9rem; resize: vertical;"></textarea>
            </div>
            <button type="submit"
                    style="padding: 0.5rem 1.5rem; background: var(--color-primary, #1e40af); color: #fff; border: none; border-radius: 0.375rem; cursor: pointer; font-size: 0.875rem;">
                {% trans "Post Comment" %}
            </button>
        </form>
    {% else %}
        <p style="color: var(--color-text-muted, #6b7280); font-size: 0.875rem;">
            {% trans "Only active members can post comments." %}
        </p>
    {% endif %}
</div>
