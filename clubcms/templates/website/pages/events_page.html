{% extends "base.html" %}
{% load wagtailcore_tags wagtailimages_tags i18n %}

{% block body_class %}page-events{% endblock %}

{% block content %}
{# Hero Section â€” dark banner like Velocity example #}
<section class="page-events__hero">
    <div class="container">
        <h1 class="page-events__hero-title">{{ page.title }}</h1>
        {% if page.intro %}
        <p class="page-events__hero-subtitle">{{ page.intro|striptags }}</p>
        {% endif %}
    </div>
</section>

<div class="page-events">
    <div class="container">
        {# Toggle upcoming / past #}
        <div class="page-events__toggle" role="tablist" aria-label="{% trans 'Event period' %}">
            <a href="{% pageurl page %}?show=upcoming" role="tab" class="btn btn-secondary" {% if show == 'upcoming' or not show %}data-active aria-selected="true"{% endif %}>
                {% trans "Upcoming" %}
            </a>
            <a href="{% pageurl page %}?show=past" role="tab" class="btn btn-secondary" {% if show == 'past' %}data-active aria-selected="true"{% endif %}>
                {% trans "Past" %}
            </a>
        </div>

        {# Category filters #}
        {% if categories %}
        <div class="page-events__filters" role="navigation" aria-label="{% trans 'Event filters' %}">
            <ul class="page-events__filter-list">
                <li class="page-events__filter-item">
                    <a href="{% pageurl page %}?show={{ show|default:'upcoming' }}" class="page-events__filter-link" {% if not current_category %}data-active{% endif %}>{% trans "All" %}</a>
                </li>
                {% for cat in categories %}
                <li class="page-events__filter-item">
                    <a href="{% pageurl page %}?show={{ show|default:'upcoming' }}&category={{ cat.slug }}" class="page-events__filter-link" {% if current_category == cat.slug %}data-active{% endif %}>
                        {{ cat.name }}
                    </a>
                </li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        {# Events listing #}
        {% if event_pages %}
        <div class="page-events__grid">
            {% for event in event_pages %}
            <article class="event-card" itemscope itemtype="https://schema.org/Event">
                {% if event.cover_image %}
                    {% image event.cover_image fill-800x450 as card_img %}
                    <div class="event-card__image">
                        <a href="{% pageurl event %}">
                            <img src="{{ card_img.url }}" alt="{{ event.title }}" loading="lazy" width="{{ card_img.width }}" height="{{ card_img.height }}">
                        </a>
                        {% if event.is_past %}
                        <span class="event-card__badge" data-variant="past">{% trans "Past" %}</span>
                        {% elif event.is_registration_open %}
                        <span class="event-card__badge" data-variant="open">{% trans "Registration Open" %}</span>
                        {% endif %}
                    </div>
                {% endif %}
                <div class="event-card__content">
                    {# Top meta: category pill + date inline #}
                    <div class="event-card__top-meta">
                        {% if event.category %}
                        <span class="event-card__category-pill">{{ event.category.name }}</span>
                        {% endif %}
                        {% if event.start_date %}
                        <span class="event-card__date" itemprop="startDate" content="{{ event.start_date|date:'c' }}">
                            {{ event.start_date|date:"M j, Y" }}{% if event.end_date and event.end_date != event.start_date %} â€“ {{ event.end_date|date:"M j, Y" }}{% endif %}
                        </span>
                        {% endif %}
                    </div>

                    <h2 class="event-card__title" itemprop="name">
                        <a href="{% pageurl event %}" itemprop="url">{{ event.title }}</a>
                    </h2>

                    {% if event.intro %}
                    <p class="event-card__excerpt">{{ event.intro|truncatewords:25 }}</p>
                    {% endif %}

                    {# Footer: location left, CTA right #}
                    <div class="event-card__footer">
                        <span class="event-card__location" itemprop="location" itemscope itemtype="https://schema.org/Place">
                            {% if event.location_name %}
                            <span aria-hidden="true">ğŸ“</span> <span itemprop="name">{{ event.location_name }}</span>
                            {% endif %}
                        </span>
                        {% if event.is_registration_open and not event.is_past %}
                        <a href="{% url 'events:register' event_pk=event.pk %}" class="event-card__cta">
                            {% trans "Register" %}
                        </a>
                        {% else %}
                        <a href="{% pageurl event %}" class="event-card__cta event-card__cta--secondary">
                            {% trans "Details" %}
                        </a>
                        {% endif %}
                    </div>
                </div>
            </article>
            {% endfor %}
        </div>

        {# Pagination #}
        {% include "includes/pagination.html" with paginator=paginator page_obj=event_pages %}

        {% else %}
        <div class="page-events__empty">
            <p>{% trans "No events found." %}</p>
        </div>
        {% endif %}

        {# Body StreamField #}
        {% if page.body %}
        <div class="page-events__body">
            {% for block in page.body %}
                {% include_block block %}
            {% endfor %}
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
